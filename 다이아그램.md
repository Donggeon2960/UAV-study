```mermaid

flowchart TD
    subgraph Sensor Input ["1. Sensing (입력)"]
        LiDAR["LiDAR (2D/3D)"]
        DepthCam["Depth Camera (RealSense)"]
    end

    subgraph Mapping ["2. Mapping (지도화)"]
        PointCloud["Point Cloud Processing"]
        LocalMap["Local Grid / Voxel Map"]
    end

    subgraph Planning_Avoidance ["3. Planning & Avoidance (판단)"]
        GlobalPath["Global Path (목표 지점)"]
        ObstacleCheck{"장애물 감지?"}
        AvoidanceAlgo["회피 알고리즘 (Potential Field, DWA)"]
        SafetyCheck{"충돌 위험?"}
        AdjustVelocity["속도/경로 수정 (Safe Velocity)"]
    end

    subgraph Control Output ["4. Control (출력)"]
        FC_Setpoint["Flight Controller (PX4/ArduPilot) Setpoint"]
        Motors["Motor Actuation"]
    end

    %% 데이터 흐름 연결
    LiDAR --> PointCloud
    DepthCam --> PointCloud
    PointCloud --> LocalMap
    LocalMap --> ObstacleCheck

    GlobalPath --> ObstacleCheck
    ObstacleCheck -- "No" --> SafetyCheck
    ObstacleCheck -- "Yes" --> AvoidanceAlgo
    AvoidanceAlgo --> SafetyCheck

    SafetyCheck -- "Safe" --> AdjustVelocity
    SafetyCheck -- "Unsafe (Stop/Hover)" --> AdjustVelocity
    
    AdjustVelocity --> FC_Setpoint
    FC_Setpoint --> Motors

    %% 스타일링
    style Sensor Input fill:#f0f0f0,stroke:#333,stroke-width:2px
    style Mapping fill:#e0f7fa,stroke:#00acc1,stroke-width:2px
    style Planning_Avoidance fill:#fff9c4,stroke:#fbc02d,stroke-width:2px
    style Control Output fill:#e8f5e9,stroke:#43a047,stroke-width:2px

    %% 핵심 노드 강조
    style AvoidanceAlgo fill:#ffecb3,stroke:#ffa000,stroke-width:3px,font-weight:bold
    style AdjustVelocity fill:#c8e6c9,stroke:#388e3c,stroke-width:3px,font-weight:bold
    }
```
